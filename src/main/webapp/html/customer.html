<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <title>用户管理</title>
    <link href="http://cdn.bootcss.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://www.layuicdn.com/layui/css/layui.css" rel="stylesheet">
    <style type="text/css">
        .modal-backdrop {
            z-index: 100;
        }
    </style>
</head>
<body class="layui-layout-body">
<div class="layui-layout layui-layout-admin">
    <!-- 导航栏  -->
    <div class="layui-header" id="myHeader">
        <div class="layui-logo">用户管理系统</div>
        <!-- 头部区域（可配合layui已有的水平导航） -->
        <ul class="layui-nav layui-layout-left">
            <li class="layui-nav-item"><a href="">控制台</a></li>
            <li class="layui-nav-item"><a href="">商品管理</a></li>
            <li class="layui-nav-item"><a href="">用户</a></li>
            <li class="layui-nav-item">
                <a href="javascript:;">其它系统</a>
                <dl class="layui-nav-child">
                    <dd><a href="">邮件管理</a></dd>
                    <dd><a href="">消息管理</a></dd>
                    <dd><a href="">授权管理</a></dd>
                </dl>
            </li>
        </ul>
        <ul class="layui-nav layui-layout-right">
            <li class="layui-nav-item">
                <a href="javascript:;">
                    <img src="https://www.zehnnanne.com/1354413904212CEA558B751E5436F492E1142D92B2.jpg"
                         class="layui-nav-img">
                    用户名
                </a>
                <dl class="layui-nav-child">
                    <dd><a href="">基本资料</a></dd>
                    <dd><a href="">安全设置</a></dd>
                    <dd><a href="">登出</a></dd>
                </dl>
            </li>
        </ul>
    </div>
    <!-- 侧边栏  -->
    <div class="layui-side layui-bg-black" id="mySider">
        <div class="layui-side-scroll">
            <!-- 左侧导航区域（可配合layui已有的垂直导航） -->
            <ul class="layui-nav layui-nav-tree" lay-filter="test">
                <li class="layui-nav-item layui-nav-itemed">
                    <a class="" href="javascript:;">功能列表</a>
                    <dl class="layui-nav-child">
                        <dd><a href="#">客户管理</a></dd>
                        <dd><a href="javascript:;">客户拜访</a></dd>
                    </dl>
                </li>
            </ul>
        </div>
    </div>
    <!--  主要内容  -->
    <div class="layui-body" id="app">
        <!-- 客户列表查询部分  start-->
        <div id="page-wrapper">
            <div class="panel panel-default">
                <div class="panel-body">
                    <form class="form-inline layui-col-space25">
                        <div class="form-group">
                            <label for="customerName">客户名称</label>
                            <input type="text" class="form-control" id="customerName"
                                   value="" name="custName"/>
                        </div>
                        <div class="form-group">
                            <label for="customerFrom">客户来源</label>
                            <select class="form-control" id="customerFrom" name="custSource" v-model="selectedFromType">
                                <option value="">--请选择--</option>
                                <option v-for="from in fromType">{{from.dict_item_name}}</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="custIndustry">所属行业</label>
                            <select class="form-control" id="custIndustry" name="custIndustry"
                                    v-model="selectedIndustryType">
                                <option value="">--请选择--</option>
                                <option v-for="industry in industryType">{{industry.dict_item_name}}</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="custLevel">客户级别</label>
                            <select class="form-control" id="custLevel" name="custLevel" v-model="selectedLevelType">
                                <option value="">--请选择--</option>
                                <option v-for="level in levelType">{{level.dict_item_name}}</option>
                            </select>
                        </div>
                        <button type="button"
                                class="layui-btn layui-btn-radius layui-btn-normal layui-btn-lg layui-col-md-offset5">
                            查询
                        </button>
                    </form>
                </div>
            </div>
            <a
                    href="#"
                    class="layui-btn
                    layui-btn-radius
                    layui-btn-normal
                    layui-btn-lg
                    layui-btn-fluid"
                    data-toggle="modal"
                    data-target="#newCustomerDialog" onclick="clearCustomer()">创建新的用户</a>
            <table class="layui-table">
                <colgroup>
                    <col width="150">
                    <col width="200">
                    <col width="200">
                    <col width="200">
                    <col width="200">
                    <col width="200">
                    <col width="200">
                    <col width="200">
                </colgroup>
                <thead>
                <tr>
                    <th>编号</th>
                    <th>客户名称</th>
                    <th>客户来源</th>
                    <th>客户所属行业</th>
                    <th>客户级别</th>
                    <th>固定电话</th>
                    <th>手机</th>
                    <th>操作</th>
                </tr>
                </thead>
                <tbody>
                <tr v-for="customer in customers">
                    <td>{{customer.cust_id}}</td>
                    <td>{{customer.cust_name}}</td>
                    <td>{{customer.cust_source}}</td>
                    <td>{{customer.cust_industry}}</td>
                    <td>{{customer.cust_level}}</td>
                    <td>{{customer.cust_phone}}</td>
                    <td>{{customer.cust_mobile}}</td>
                    <td>
                        <button class="layui-btn layui-btn-radius layui-btn-normal layui-btn-sm" data-toggle="modal"
                                data-target="#customerEditDialog">编辑
                        </button>
                        <button class="layui-btn layui-btn-radius layui-btn-danger layui-btn-sm">删除</button>
                    </td>
                </tr>
                </tbody>
            </table>
        </div>
        <!-- 客户列表查询部分  end-->
        <!--   分页     -->
        <div id="page" class="text-center"></div>
    </div>
    <!--    创建用户模态框    -->
    <div class="modal fade" id="newCustomerDialog" tabindex="-1" role="dialog"
         aria-labelledby="myModalLabel">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                    <h4 class="modal-title" id=" myModalLabel">新建客户信息</h4>
                </div>
                <div class="modal-body">
                    <form class="form-horizontal" id="new_customer_form">
                        <div class="form-group">
                            <label for="new_customerName" class="col-sm-2 control-label">
                                客户名称
                            </label>
                            <div class="col-sm-10">
                                <input type="text" class="form-control" id="new_customerName" placeholder="客户名称"
                                       name="cust_name"/>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="new_customerFrom" style="float:left;padding:7px 15px 0 27px;">客户来源</label>
                            <div class="col-sm-10">
                                <select class="form-control" id="new_customerFrom" name="cust_source">
                                    <option value="">--请选择--</option>
                                    <!--                                <c:forEach items="${fromType}" var="item">-->
                                    <!--                                    <option value="${item.dict_id}"-->
                                    <!--                                    <c:if test="${item.dict_id == custSource}">selected</c:if>-->
                                    <!--                                    >-->
                                    <!--                                    ${item.dict_item_name }-->
                                    <!--                                    </option>-->
                                    <!--                                </c:forEach>-->
                                </select>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="new_custIndustry" style="float:left;padding:7px 15px 0 27px;">所属行业</label>
                            <div class="col-sm-10">
                                <select class="form-control" id="new_custIndustry" name="cust_industry">
                                    <option value="">--请选择--</option>
                                    <!--                                <c:forEach items="${industryType}" var="item">-->
                                    <!--                                    <option value="${item.dict_id}"-->
                                    <!--                                    <c:if-->
                                    <!--                                            test="${item.dict_id == custIndustry}"> selected-->
                                    <!--                                    </c:if>-->
                                    <!--                                    >-->
                                    <!--                                    ${item.dict_item_name }-->
                                    <!--                                    </option>-->
                                    <!--                                </c:forEach>-->
                                </select>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="new_custLevel" style="float:left;padding:7px 15px 0 27px;">客户级别</label>
                            <div class="col-sm-10">
                                <select class="form-control" id="new_custLevel" name="cust_level">
                                    <option value="">--请选择--</option>
                                    <!--                                <c:forEach items="${levelType}" var="item">-->
                                    <!--                                    <option value="${item.dict_id}"-->
                                    <!--                                    <c:if-->
                                    <!--                                            test="${item.dict_id == custLevel}"> selected-->
                                    <!--                                    </c:if>-->
                                    <!--                                    >${item.dict_item_name }</option>-->
                                    <!--                                </c:forEach>-->
                                </select>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="new_linkMan" class="col-sm-2 control-label">联系人</label>
                            <div class="col-sm-10">
                                <input type="text" class="form-control" id="new_linkMan" placeholder="联系人"
                                       name="cust_linkman"/>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="new_phone" class="col-sm-2 control-label">固定电话</label>
                            <div class="col-sm-10">
                                <input type="text" class="form-control" id="new_phone" placeholder="固定电话"
                                       name="cust_phone"/>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="new_mobile" class="col-sm-2 control-label">移动电话</label>
                            <div class="col-sm-10">
                                <input type="text" class="form-control" id="new_mobile" placeholder="移动电话"
                                       name="cust_mobile"/>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="new_zipcode" class="col-sm-2 control-label">邮政编码</label>
                            <div class="col-sm-10">
                                <input type="text" class="form-control" id="new_zipcode" placeholder="邮政编码"
                                       name="cust_zipcode"/>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="new_address" class="col-sm-2 control-label">联系地址</label>
                            <div class="col-sm-10">
                                <input type="text" class="form-control" id="new_address" placeholder="联系地址"
                                       name="cust_address"/>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
                    <button type="button" class="btn btn-primary" onclick="createCustomer()">创建客户</button>
                </div>
            </div>
        </div>
    </div>
    <!-- 修改客户模态框 -->
    <div class="modal fade" id="customerEditDialog" tabindex="-1" role="dialog"
         aria-labelledby="myModalLabel">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                    <h4 class="modal-title" id="myModalLabel">修改客户信息</h4>
                </div>
                <div class="modal-body">
                    <form class="form-horizontal" id="edit_customer_form">
                        <input type="hidden" id="edit_cust_id" name="cust_id"/>
                        <div class="form-group">
                            <label for="edit_customerName" class="col-sm-2 control-label">客户名称</label>
                            <div class="col-sm-10">
                                <input type="text" class="form-control" id="edit_customerName" placeholder="客户名称"
                                       name="cust_name"/>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="edit_customerFrom" style="float:left;padding:7px 15px 0 27px;">客户来源</label>
                            <div class="col-sm-10">
                                <select class="form-control" id="edit_customerFrom" name="cust_source">
                                    <option value="">--请选择--</option>
                                    <!--                                    <c:forEach items="${fromType}" var="item">-->
                                    <!--                                        <option value="${item.dict_id}"<c:if-->
                                    <!--                                            test="${item.dict_id == custSource}"> selected</c:if>>${item.dict_item_name }</option>-->
                                    <!--                                    </c:forEach>-->
                                </select>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="edit_custIndustry" style="float:left;padding:7px 15px 0 27px;">所属行业</label>
                            <div class="col-sm-10">
                                <select class="form-control" id="edit_custIndustry" name="cust_industry">
                                    <option value="">--请选择--</option>
                                    <!--                                    <c:forEach items="${industryType}" var="item">-->
                                    <!--                                        <option value="${item.dict_id}"<c:if-->
                                    <!--                                            test="${item.dict_id == custIndustry}"> selected</c:if>>${item.dict_item_name }</option>-->
                                    <!--                                    </c:forEach>-->
                                </select>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="edit_custLevel" style="float:left;padding:7px 15px 0 27px;">客户级别</label>
                            <div class="col-sm-10">
                                <select class="form-control" id="edit_custLevel" name="cust_level">
                                    <option value="">--请选择--</option>
                                    <!--                                    <c:forEach items="${levelType}" var="item">-->
                                    <!--                                        <option value="${item.dict_id}"<c:if-->
                                    <!--                                            test="${item.dict_id == custLevel}"> selected</c:if>>${item.dict_item_name }</option>-->
                                    <!--                                    </c:forEach>-->
                                </select>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="edit_linkMan" class="col-sm-2 control-label">联系人</label>
                            <div class="col-sm-10">
                                <input type="text" class="form-control" id="edit_linkMan" placeholder="联系人"
                                       name="cust_linkman"/>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="edit_phone" class="col-sm-2 control-label">固定电话</label>
                            <div class="col-sm-10">
                                <input type="text" class="form-control" id="edit_phone" placeholder="固定电话"
                                       name="cust_phone"/>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="edit_mobile" class="col-sm-2 control-label">移动电话</label>
                            <div class="col-sm-10">
                                <input type="text" class="form-control" id="edit_mobile" placeholder="移动电话"
                                       name="cust_mobile"/>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="edit_zipcode" class="col-sm-2 control-label">邮政编码</label>
                            <div class="col-sm-10">
                                <input type="text" class="form-control" id="edit_zipcode" placeholder="邮政编码"
                                       name="cust_zipcode"/>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="edit_address" class="col-sm-2 control-label">联系地址</label>
                            <div class="col-sm-10">
                                <input type="text" class="form-control" id="edit_address" placeholder="联系地址"
                                       name="cust_address"/>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
                    <button type="button" class="btn btn-primary" onclick="updateCustomer()">保存修改</button>
                </div>
            </div>
        </div>
    </div>
    <div class="layui-footer">
        <!-- 底部固定区域 -->
        © www.zehnnanne.com
    </div>
</div>
<!-- jQuery -->
<script src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.min.js"></script>
<!-- Bootstrap Core JavaScript -->
<script src="https://cdn.staticfile.org/twitter-bootstrap/3.3.7/js/bootstrap.min.js"></script>
<script src="https://www.layuicdn.com/layui/layui.js"></script>
<!--Vue-->
<script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
<script>
    layui.use('element', function () {
        var element = layui.element;

    });
    var app = new Vue({
        el: '#app',
        data: {
            customers: '',
            count: '100',
            fromType: '',
            industryType: '',
            levelType: '',
            selectedFromType: '',
            selectedIndustryType: '',
            selectedLevelType: ''
        },
        methods: {
            get_customers: function (page) {
                $.get({
                    url: 'http://localhost:8080/bootProjectOrigin_war/customers',
                    data: {
                        "page": page,
                        "rows": 10
                    },
                    contentType: 'text/plain',
                    beforeSend: function (request) {
                        request.setRequestHeader("Authorization", sessionStorage.getItem("Authorization"))
                    },
                    success: function (msg) {
                        console.log(msg.data[0].rows)
                        // 在created过程中给vue实例赋值要用对象名而不是this
                        app.customers = msg.data[0].rows
                        app.count = msg.data[0].total;
                        app.fromType = msg.data[1]
                        app.industryType = msg.data[2]
                        app.levelType = msg.data[3]
                        console.log("get" + app.count)
                        app.pagination(msg.data[0].page, msg.data[0].total)
                    }
                })
            },
            pagination: function (curr, count) {
                layui.use('laypage', function () {
                    var laypage = layui.laypage;
                    //执行一个laypage实例
                    laypage.render({
                        elem: 'page',
                        count: count,
                        skin: 'blue',
                        curr: curr,
                        jump: function (obj, first) {
                            console.log(obj)
                            console.log(first)
                            if (!first) {
                                console.log("page" + this.count)
                                app.get_customers(obj.curr)
                            }
                        }
                    });
                });
            }
        },
        created() {
            this.get_customers(1)
        },
    })
    var new_modal = new Vue({
        el: "#newCustomerDialog",
        data: {},
        methods: {}
    })
    var edit_modal = new Vue({
        el: "#customerEditDialog",
        data: {},
        methods: {}
    })

    //清空新建客户窗口中的数据
    function clearCustomer() {
        $("#new_customerName").val("");
        $("#new_customerFrom").val("")
        $("#new_custIndustry").val("")
        $("#new_custLevel").val("")
        $("#new_linkMan").val("");
        $("#new_phone").val("");
        $("#new_mobile").val("");
        $("#new_zipcode").val("");
        $("#new_address").val("");
    }
</script>
</body>
</html>